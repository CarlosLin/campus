<%= link_to 'New', new_post_path, class: 'btn btn-default' %>
<div id="npage">
  <%= will_paginate @posts, :style=>"display:none;"%>
</div>
<div class="row posts"  id="masonry">
  <% @posts.order('id DESC').each do |post| %>
  <div class="col-xs-6 col-md-2 box">
    <div class="image-wrapper overlay-fade-in" >
    <% if post.cover_image || post.avatar_file_name %>
      <%= index_cover_image(post) %>
    <% else %>
      <%= image_tag "default.jpg", class: 'thumbnail'  %>
    <% end %>
      <div class="image-overlay-content fancybox" rel="gallery"  data-fancybox-href="posts/<%=post.id%>" href="javascript:;">
        <h2><%= post.name %></h2>
      </div>
      <div class="post_data">
        <i class="fa fa-eye"> <%= post.hits %></i>
        <i class="fa fa-heart"><%= post.favorites.count %></i>
      </div>
    </div>
  </div>
  <% end %>
</div>

<script type="text/javascript">
  $(function() {
    var $container = $('#masonry');
    $container.imagesLoaded(function(){
      $container.masonry({
        columnWidth: 20,
        itemSelector: '.box',
        gutter: 20
      });
    });
    $container.infinitescroll({
      navSelector : "#npage",
      nextSelector : "#npage a",
      itemSelector : ".box",
      pixelsFromNavToBottom: 300
    },
    function(newElements) {
      var $newElems = $(newElements).css({opacity: 0});
      $newElems.imagesLoaded(function(){
        $newElems.animate({opacity: 1});
        $container.masonry('appended', $newElems, true);
      });
    });
    $(".fancybox").fancybox({
      // API options 
      openEffect  : 'elastic',
      closeEffect : 'elastic',
      autoScale: false,
      type: 'iframe',
      padding: 0,
      autoSize: false,
      width: "55%",
      height: "auto",
      helpers : {
        overlay : {
          css : {
              'background' : 'rgba(0, 0, 0, .8)'
          }
        }
      }
    });
  });
</script>